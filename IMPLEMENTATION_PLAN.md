# Implementation Plan
- [x] Create the new public `agent-spaces` surface with `createAgentSpacesClient`
  - [x] Decide where the package lives (`packages/cli` vs new `packages/agent-spaces`) and ensure import path is `agent-spaces`.
  - [x] Define `AgentSpacesClient`, request/response types, `SpaceSpec`, `AgentEvent`, and `AgentSpacesError` per spec.
  - [x] Update package exports/bundling to prevent `spaces-config`/`spaces-execution` imports from the public surface.
- [x] Implement `resolve` and `describe` using `SpaceSpec` with aspHome-only operational config
  - [x] Validate `spec` exclusivity and absolute `targetDir`; map `targetDir` to existing resolver/materializer functions.
  - [x] Wire `spec.spaces` to explicit ref resolution (no TOML parsing) and `spec.target` to `asp-targets.toml`.
  - [x] Map resolution failures to `resolve_failed` errors without exposing internal cache/lock details.
- [x] Implement `runTurn` orchestration with harness session continuity
  - [x] Define a disk-backed session record under `aspHome` to store `harnessSessionId` and harness metadata.
  - [x] Add harness-specific resume/create paths (agent-sdk/Pi SDK) and return `harness_session_not_found` when resume fails.
  - [x] Ensure `env` is passed through verbatim, `cwd` is honored, and `attachments` are routed to harnesses that support them.
- [x] Build the event bridge that matches the spec
  - [x] Map unified session events and harness output into `AgentEvent` types with `seq`, `ts`, `externalSessionId`, `externalRunId`, and `harnessSessionId`.
  - [x] Guarantee ordered emission by awaiting async `onEvent` callbacks.
  - [x] Emit exactly one `complete` event per run and resolve `runTurn` only after it is sent.
- [x] Add harness capabilities and model validation
  - [x] Provide a static supported-models listing in the public client (provider prefixes included).
  - [x] Implement `getHarnessCapabilities` and return `model_not_supported` on invalid model requests.
- [x] Enforce permissions-disabled behavior and Pi harness flags
  - [x] Auto-approve tools in session implementations; remove interactive permission hooks from the public boundary.
  - [x] Add `--no-skills` to Pi CLI args and keep `--no-extensions` when no extensions exist.
  - [x] Ensure `PI_CODING_AGENT_DIR` is set for Pi CLI runs and appears in dry-run command output.
- [x] Implement `describe()` inventory for hooks/skills/tools
  - [x] Reuse `discoverSkills` for skills names and derive hook names from hooks configs.
  - [x] Extract tool names from MCP configs and/or harness-specific bundles without exposing details.
  - [x] Return names-only arrays in `DescribeResponse`.
- [x] Tests and validation coverage
  - [x] Add unit tests for new client surface, error mapping, and model validation.
  - [x] Add harness session resume tests.
  - [x] Update/replace existing tests that assert CP context or Pi `--no-skills` behavior.
- [x] Address Biome complexity warning in `PiAdapter.composeTarget` (86 > 85).
