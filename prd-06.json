{
  "project": "Agent Spaces v2",
  "branchName": "ralph/phase-6-linting",
  "description": "Phase 6 - Linting Rules: Implement all warning rules and the lint system",
  "userStories": [
    {
      "id": "US-001",
      "title": "Implement Lint Runner Infrastructure",
      "description": "As a developer, I need a lint runner that collects and reports results.",
      "acceptanceCriteria": [
        "LintRunner class in packages/lint/src/index.ts",
        "runner.addRule(rule: LintRule) method",
        "runner.lintSpace(space: Space, snapshotPath: string): Promise<LintResult> method",
        "runner.lintProject(config: TargetsConfig, closure: Closure): Promise<LintResult> method",
        "LintResult includes warnings: Warning[], errors: Error[]",
        "Unit tests",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Implement Lint Rule Interface",
      "description": "As a developer, I need a standard interface for lint rules.",
      "acceptanceCriteria": [
        "LintRule interface with code, name, description",
        "check(context: LintContext): Promise<Diagnostic[]> method",
        "Diagnostic includes code, severity, message, location?",
        "location includes file, line?, column?",
        "Rules can be async (for file I/O)",
        "Unit tests",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Implement W201 Command Name Collision",
      "description": "As a user, I need to know when multiple spaces define the same command name.",
      "acceptanceCriteria": [
        "Rule code: W201",
        "Detects when two spaces in load order have same command filename",
        "Warning message includes: both space IDs, command name",
        "Example: W201: Command 'build' defined in both 'frontend' and 'backend'. Later space wins.",
        "Only triggers for project-level lint (needs multiple spaces)",
        "Unit tests",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Implement W203 Hook Path Missing Plugin Root",
      "description": "As a user, I need to know when hook paths don't use the plugin root variable.",
      "acceptanceCriteria": [
        "Rule code: W203",
        "Reads hooks/hooks.json if exists",
        "Checks each hook command path",
        "Warns if path doesn't start with ${CLAUDE_PLUGIN_ROOT}",
        "Warning message: W203: Hook 'PreToolUse' uses absolute path. Use ${CLAUDE_PLUGIN_ROOT} for portability.",
        "Triggers for space-level lint",
        "Unit tests",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Implement W204 Invalid Hooks Config",
      "description": "As a user, I need to know when my hooks configuration is invalid.",
      "acceptanceCriteria": [
        "Rule code: W204",
        "Checks if hooks/ directory exists",
        "If exists, checks hooks/hooks.json exists",
        "Validates hooks.json against schema",
        "Checks referenced scripts exist",
        "Warning message: W204: hooks/ directory exists but hooks/hooks.json is missing/invalid",
        "Triggers for space-level lint",
        "Unit tests",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Implement W205 Plugin Name Collision",
      "description": "As a user, I need to know when multiple spaces produce the same plugin name.",
      "acceptanceCriteria": [
        "Rule code: W205",
        "Detects when two spaces resolve to same plugin name (from space.toml name field)",
        "Warning message: W205: Spaces 'my-space' and 'other-space' both produce plugin name 'my-plugin'",
        "Only triggers for project-level lint",
        "Unit tests",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Implement W206 Non-Executable Hook Script",
      "description": "As a user, I need to know when hook scripts aren't executable.",
      "acceptanceCriteria": [
        "Rule code: W206",
        "Checks scripts referenced in hooks.json",
        "Warns if script exists but not executable",
        "Warning message: W206: Hook script 'hooks/pre-tool.sh' is not executable",
        "Suggests fix: chmod +x hooks/pre-tool.sh",
        "Triggers for space-level lint",
        "Unit tests",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Implement Lock Coherence Check",
      "description": "As a user, I need to know when my lock file is out of sync with targets.",
      "acceptanceCriteria": [
        "Detects when asp-lock.json doesn't match asp-targets.toml",
        "Warns on: missing spaces, extra spaces, version mismatches",
        "Error (not warning) for critical mismatches",
        "Message: Lock file out of sync. Run 'asp install' to update.",
        "Triggers for project-level lint",
        "Unit tests",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Implement Space Manifest Validator",
      "description": "As a user, I need to validate my space.toml is well-formed.",
      "acceptanceCriteria": [
        "Validates space.toml against schema",
        "Checks required fields present",
        "Checks id matches directory name convention",
        "Checks name is valid kebab-case",
        "Errors for invalid manifest (blocks publish)",
        "Triggers for space-level lint",
        "Unit tests",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Implement Lint Reporter",
      "description": "As a developer, I need formatted output for lint results.",
      "acceptanceCriteria": [
        "LintReporter class in packages/lint/src/reporter.ts",
        "formatHuman(result: LintResult): string for terminal output",
        "formatJson(result: LintResult): string for JSON output",
        "Human format: colored, grouped by file, with context",
        "JSON format: structured array of diagnostics",
        "Summary line: X warnings, Y errors",
        "Unit tests",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Implement Warning Suppression",
      "description": "As a user, I need to suppress specific warnings I've acknowledged.",
      "acceptanceCriteria": [
        "Support # asp-lint-ignore: W201 comment in space.toml",
        "Support asp.lint.ignore array in space.toml",
        "Suppressed warnings still collected but marked suppressed: true",
        "Human output shows suppressed count",
        "JSON output includes suppressed diagnostics",
        "Unit tests",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Implement Project-Level Lint Entry Point",
      "description": "As a developer, I need a function that lints an entire project.",
      "acceptanceCriteria": [
        "lintProject(projectPath: string): Promise<LintResult> function",
        "Loads asp-targets.toml",
        "Loads asp-lock.json if exists",
        "Runs lock coherence check",
        "Runs collision checks across all targets",
        "Aggregates results from all rules",
        "Integration test",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Implement Space-Level Lint Entry Point",
      "description": "As a developer, I need a function that lints a single space.",
      "acceptanceCriteria": [
        "lintSpace(spacePath: string): Promise<LintResult> function",
        "Loads space.toml",
        "Runs manifest validation",
        "Runs hooks validation",
        "Runs all space-level rules",
        "Integration test",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": false,
      "notes": ""
    }
  ]
}
